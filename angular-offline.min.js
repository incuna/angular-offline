/*! Angular offline v0.1.0 | (c) 2016 Greg Berg√© | License MIT */
angular.module("offline",[]).service("connectionStatus",["$window","$rootScope",function(a,b){this.isOnline=function(){return a.navigator.onLine},this.$on=function(c,d){a.addEventListener(c,function(){b.$apply(d)})}}]).provider("offline",function(){var a,b=this;b.debug=function(a){return this._debug=a,this},b.alwaysRefresh=function(a){return this._alwaysRefresh=a,this},b.alwaysOffline=function(a){return this._alwaysOffline=a,this},b.excludeCacheIds=function(a){return this._excludeCacheIds=a,this},this.$get=["$q","$rootScope","$window","$log","connectionStatus","$cacheFactory",function(c,d,e,f,g,h){function i(){return b._debug?f.debug.apply(f,["%cOffline","font-weight: bold"].concat([].slice.call(arguments))):void 0}function j(b){return b===!0&&(b=a.defaults.cache||h.get("$http")),b}function k(a,c){a=j(a);var d=a.info(c);(b._alwaysRefresh||d&&d.isExpired)&&a.remove(c)}function l(){return s.stackCache||t}function m(){var a=l();return a.get("stack")||[]}function n(a){var b=l();b.put("stack",a)}function o(a){var b=m();b.push(a),n(b)}function p(){var a=m(),b=a.shift();return n(a),b}function q(a){o({url:a.url,data:a.data,headers:a.headers,method:a.method,offline:a.offline,timeout:angular.isNumber(a.timeout)?a.timeout:void 0})}function r(){var b=p();return b?(i("will process request",b),a(b).then(function(a){return i("request success",a),d.$broadcast("offline-request:success",a,b),a},function(a){return i("request error",a),d.$broadcast("offline-request:error",a,b),c.reject(a)})):c.reject(new Error(s.ERRORS.EMPTY_STACK))}var s={ERRORS:{EMPTY_STACK:"empty stack",REQUEST_QUEUED:"request queued"}},t=h("offline-request-stack");return s.processStack=function(){return g.isOnline()?r().then(s.processStack)["catch"](function(a){return a&&a.message===s.ERRORS.EMPTY_STACK?void i("all requests completed"):a&&a.message===s.ERRORS.REQUEST_QUEUED?void i("request has been queued, stop"):s.processStack()}):void 0},s.start=function(b){a=b,g.$on("online",s.processStack),s.processStack()},s.interceptors={request:function(a){if(a.offline===!1)return a;if(a.offline!==!0&&!b._alwaysOffline)return a;i("intercept request",a),a.cache||(a.cache=!0);var d=j(a.cache),e=d.info(),f=e.id;return f&&-1!==b._excludeCacheIds.indexOf(f)?a:"GET"===a.method?(g.isOnline()&&k(a.cache,a.url),a):g.isOnline()?a:(q(a),c.reject(new Error(s.ERRORS.REQUEST_QUEUED)))}},s}]}).config(["$provide","$httpProvider",function(a,b){a.factory("offlineInterceptor",["offline",function(a){return a.interceptors}]),b.interceptors.push("offlineInterceptor")}]);
//# sourceMappingURL=angular-offline.min.js.map